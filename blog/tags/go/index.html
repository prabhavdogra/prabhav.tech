<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">3 posts tagged with &quot;Go&quot; | Hello!</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://prabhavdogra.github.io/prabhav.tech/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://prabhavdogra.github.io/prabhav.tech/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://prabhavdogra.github.io/prabhav.tech/blog/tags/go"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="3 posts tagged with &quot;Go&quot; | Hello!"><meta data-rh="true" name="description" content="Golang exploration projects"><meta data-rh="true" property="og:description" content="Golang exploration projects"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/prabhav.tech/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://prabhavdogra.github.io/prabhav.tech/blog/tags/go"><link data-rh="true" rel="alternate" href="https://prabhavdogra.github.io/prabhav.tech/blog/tags/go" hreflang="en"><link data-rh="true" rel="alternate" href="https://prabhavdogra.github.io/prabhav.tech/blog/tags/go" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/prabhav.tech/blog/rss.xml" title="Hello! RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/prabhav.tech/blog/atom.xml" title="Hello! Atom Feed"><link rel="stylesheet" href="/prabhav.tech/assets/css/styles.99dca371.css">
<script src="/prabhav.tech/assets/js/runtime~main.c8ef9b75.js" defer="defer"></script>
<script src="/prabhav.tech/assets/js/main.6115d79a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/prabhav.tech/img/docusaurus.png"><link rel="preload" as="image" href="https://media.licdn.com/dms/image/v2/D5603AQGHJzJ1YVb_og/profile-displayphoto-shrink_800_800/B56ZS6fOAFHEAc-/0/1738295534859?e=1746057600&amp;v=beta&amp;t=wTqgffLNqUVaz0xEk2OUDSEvKATaSevxvWuI99mG9XY"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prabhav.tech/"><div class="navbar__logo"><img src="/prabhav.tech/img/docusaurus.png" alt="prabhav.tech" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/prabhav.tech/img/docusaurus.png" alt="prabhav.tech" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/prabhav.tech/blog">Blogs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/prabhavdogra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/prabhav.tech/blog/memory_hierarchy">What does memory mean actually?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/prabhav.tech/blog/diy_goroutines">Writing your own Goroutines</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/prabhav.tech/blog/atomic_operations">How Go atomic operations avoid race conditions?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/prabhav.tech/blog/ray_tracer">Building a Ray Tracer in C++</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>3 posts tagged with &quot;Go&quot;</h1><p>Golang exploration projects</p><a href="/prabhav.tech/blog/tags">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/prabhav.tech/blog/memory_hierarchy">What does memory mean actually?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-03-12T00:00:00.000Z">March 12, 2025</time> Â· <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/prabhav.tech/blog/authors/prabhavdogra"><img class="avatar__photo authorImage_XqGP" src="https://media.licdn.com/dms/image/v2/D5603AQGHJzJ1YVb_og/profile-displayphoto-shrink_800_800/B56ZS6fOAFHEAc-/0/1738295534859?e=1746057600&amp;v=beta&amp;t=wTqgffLNqUVaz0xEk2OUDSEvKATaSevxvWuI99mG9XY" alt="Prabhav Dogra"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/prabhav.tech/blog/authors/prabhavdogra"><span class="authorName_yefp">Prabhav Dogra</span></a></div><small class="authorTitle_nd0D" title="Software Engineer II @ Blinkit">Software Engineer II @ Blinkit</small><div class="authorSocials_rSDt"><a href="https://github.com/prabhavdogra" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://www.linkedin.com/in/prabhav-dogra/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" class="authorSocialLink_owbf"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453" fill="#0A66C2"></path></svg></a></div></div></div></div></div></header><div class="markdown"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">â</a></h3>
<p>While exploring how Go manages memory, I stumbled upon an intricate hierarchy that determines how fast data moves between the CPU and RAM. Goâs runtime optimizations, like garbage collection and stack allocation, made me curious about what happens under the hood. This led me to registers, caches (L1, L2, L3), and RAMâeach playing a crucial role in balancing speed and storage.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites-whats-a-cpu-cycle">Prerequisites: What&#x27;s a CPU Cycle?<a href="#prerequisites-whats-a-cpu-cycle" class="hash-link" aria-label="Direct link to Prerequisites: What&#x27;s a CPU Cycle?" title="Direct link to Prerequisites: What&#x27;s a CPU Cycle?">â</a></h2>
<p><strong>CPU Cycle:</strong></p>
<ul>
<li>It&#x27;s the smallest unit of processing that a CPU can do.</li>
<li>Each cycle allows the CPU to execute instructions like fetching data, performing arithmetic, or storing results.</li>
<li>For example: the method <code>atomic.CompareAndSwap</code> in go is executed as follows:<!-- -->
<ul>
<li>It reads a value from memory.</li>
<li>It compares it with an expected value.</li>
<li>If they match, it writes a new value.</li>
<li>This requires at least three steps (read, compare, write), which take multiple cycles.</li>
</ul>
</li>
<li>A single 1GHz CPU can complete one CPU cycle in 1 nanosecond.</li>
<li>Similarly, a 3GHz CPU can complete one CPU cycle in 0.33 nanoseconds.</li>
<li>Not Every Operation Takes 1 Cycle<!-- -->
<ul>
<li>Simple instructions like integer addition (a + b) may take 1 cycle.</li>
<li>More complex operations (e.g., division, memory access) can take multiple cycles.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-computer-memory-hierarchy">Understanding Computer Memory Hierarchy<a href="#understanding-computer-memory-hierarchy" class="hash-link" aria-label="Direct link to Understanding Computer Memory Hierarchy" title="Direct link to Understanding Computer Memory Hierarchy">â</a></h2>
<ol>
<li><strong>Registers (Fastest, Smallest)</strong>
<ul>
<li>Located inside the CPU, closest to the execution units.</li>
<li>Stores data for immediate operations (e.g., arithmetic calculations).</li>
<li>Extremely small (few bytes) but operates at CPU clock speed.</li>
<li>Access time: 1 CPU cycle (fastest).</li>
</ul>
</li>
<li><strong>L1 Cache (Level 1)</strong>
<ul>
<li>Smallest and fastest cache (typically 32KB to 128KB per core).</li>
<li>Directly integrated into the CPU core.</li>
<li>Stores frequently used instructions and data for ultra*fast access.</li>
<li>Access time: 2-4 CPU cycles.</li>
</ul>
</li>
<li><strong>L2 Cache (Level 2)</strong>
<ul>
<li>Larger than L1 (256KB to a few MB per core).</li>
<li>Slightly slower than L1 but still much faster than RAM.</li>
<li>Used to store recently accessed data that might be needed again soon.</li>
<li>Access time: 10-20 CPU cycles.</li>
</ul>
</li>
<li><strong>L3 Cache (Level 3)</strong>
<ul>
<li>Shared among multiple CPU cores, ranging from a few MB to tens of MB.</li>
<li>Acts as a buffer between L2 and RAM, reducing latency for core-to-core communication.</li>
<li>Access time: 30-60 CPU cycles.</li>
</ul>
</li>
<li><strong>RAM (Random Access Memory)</strong>
<ul>
<li>Main working memory for the system (GBs in size).</li>
<li>Much slower than CPU caches but holds more data.</li>
<li>Stores active processes and data that arenât frequently used by the CPU.</li>
<li>Access time: 100+ CPU cycles.</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="registers-the-fastest-storage">Registers: The Fastest Storage<a href="#registers-the-fastest-storage" class="hash-link" aria-label="Direct link to Registers: The Fastest Storage" title="Direct link to Registers: The Fastest Storage">â</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-registers">What Are Registers?<a href="#what-are-registers" class="hash-link" aria-label="Direct link to What Are Registers?" title="Direct link to What Are Registers?">â</a></h3>
<p>Registers are ultra-fast, small storage units embedded directly inside a computerâs CPU (Central Processing Unit). They are temporary holding areas for data, instructions, or memory addresses that the CPU needs to access immediately during computations. Registers are the fastest type of memory in a computer, designed to minimize delays in processing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-registers-work">How Registers Work?<a href="#how-registers-work" class="hash-link" aria-label="Direct link to How Registers Work?" title="Direct link to How Registers Work?">â</a></h3>
<ul>
<li><strong>Fetching Data:</strong> When the CPU needs to perform an operation (e.g., 5 + 3), it first copies the values 5 and 3 from RAM into two registers.</li>
<li><strong>Processing:</strong> The CPUâs arithmetic logic unit (ALU) performs the addition directly using the values stored in the registers.</li>
<li><strong>Storing Results:</strong> The result (8) is placed into another register, which can either be used for further operations or written back to RAM.</li>
</ul>
<ol>
<li>
<p><strong>Basic Structure: Flip-Flops</strong></p>
<ul>
<li><strong>Core Component:</strong> Registers are built using D-type flip-flops, which store one bit each. A 32-bit register, for example, contains 32 flip-flops.</li>
<li><strong>Function:</strong> Each flip-flop has:<!-- -->
<ul>
<li><strong>Data Input (D):</strong> Receives the bit to store.</li>
<li><strong>Clock Input (CLK):</strong> Synchronizes when the input is captured. This means that data is not stored immediately when placed on the input but is instead captured only when the clock signal triggers.</li>
<li><strong>Output (Q):</strong> Provides the stored bit.</li>
<li><strong>Write Enable (WE):</strong> Determines if the flip-flop updates its value on the next CPU cycle</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Data Storage and Clock Synchronization</strong></p>
<p><strong>Writing Data:</strong></p>
<ul>
<li>When the CPU writes to a register:<!-- -->
<ul>
<li>The write enable signal for the register is activated.</li>
<li>Data is placed on the <strong>input bus</strong>.  The input bus is a set of electrical connections that carry data to the register.</li>
<li>In the <strong>next CPU Cycle</strong>, the flip-flops capture the input values.</li>
</ul>
</li>
</ul>
<p><strong>Reading Data:</strong></p>
<ol>
<li><strong>Stored Data in Flip-Flops</strong>
<ul>
<li>A register consists of multiple flip-flops, each storing a single bit. Once a value is stored in a flip-flop, it remains available at its output until changed by a new write operation. However, this stored value is not automatically placed on the CPUâs internal busâsomething must send the data when the data is read.</li>
<li>Each flip-flop&#x27;s output is connected to a tri-state buffer, which controls whether the stored bit is driven onto the bus connecting CPU and register (for reading the bit).</li>
</ul>
</li>
<li><strong>Role of the Tri-State Buffer</strong>
<ul>
<li>Tri-State Buffer ensures conflict-free (kindof like mutex) data access, enabling the CPU to perform billions of operations per second reliably.</li>
<li>A tri-state buffer is a special circuit that can either:<!-- -->
<ul>
<li><strong>Tri-State Buffer Enabled:</strong> Passes the stored data from the register to the bus connecting CPU and register.</li>
<li><strong>Tri-State Buffer Disabled:</strong> Disconnects the register from bus connecting CPU and register.</li>
</ul>
</li>
<li>This is necessary because multiple registers share the same internal bus, and only one should be active at a time to avoid conflicting reads and writes.</li>
<li>The enable signal is synchronized with the CPU clock to ensure stable data transfer.</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="types-of-registers">Types of Registers<a href="#types-of-registers" class="hash-link" aria-label="Direct link to Types of Registers" title="Direct link to Types of Registers">â</a></h3>
<ul>
<li><strong>General-Purpose Registers:</strong>
<ul>
<li>Used for temporary data storage and most calculations.</li>
</ul>
</li>
<li><strong>Special-Purpose Registers:</strong>
<ul>
<li><strong>Program Counter (PC):</strong> Holds the memory address of the next instruction to execute.</li>
<li><strong>Instruction Register (IR):</strong> Stores the current instruction being decoded/executed.</li>
<li><strong>Stack Pointer (SP)</strong>: Tracks the top of the stack in memory.</li>
<li><strong>Status/Flag Register</strong>: Stores metadata about operations (e.g., whether a result was zero or caused an overflow).</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-registers-are-essential">Why Registers Are Essential<a href="#why-registers-are-essential" class="hash-link" aria-label="Direct link to Why Registers Are Essential" title="Direct link to Why Registers Are Essential">â</a></h3>
<ul>
<li><strong>Eliminate Bottlenecks:</strong> Without registers, the CPU would need to read/write data directly from RAM for every operation, which is too slow.</li>
<li><strong>Enable Pipelining:</strong> Registers allow the CPU to work on multiple instructions simultaneously by holding intermediate states.</li>
<li><strong>Direct Hardware Access:</strong> Registers interface directly with the CPUâs ALU and control unit, enabling rapid execution of machine-level instructions.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cpu-cache-l1-l2-l3-cpu-caches">CPU Cache: L1, L2, L3 CPU caches<a href="#cpu-cache-l1-l2-l3-cpu-caches" class="hash-link" aria-label="Direct link to CPU Cache: L1, L2, L3 CPU caches" title="Direct link to CPU Cache: L1, L2, L3 CPU caches">â</a></h2>
<p>CPU Caches are small, ultra-fast memory layers between the CPU and main memory (RAM). They store frequently accessed data and instructions to reduce latency and improve performance. Modern CPUs use three levels of cache:</p>
<p>There are two types of cached instructions:</p>
<ul>
<li><strong>Instruction Cache:</strong>
<ul>
<li><strong>What it stores:</strong>
<ul>
<li>Instructions are the actual binary code (machine code) of the program being executed by the CPU.</li>
<li>Examples: <code>ADD</code>, <code>MOV</code>, <code>JUMP</code>, <code>LOAD</code>, or any operation the CPU performs.</li>
</ul>
</li>
<li><strong>Purpose:</strong>
<ul>
<li>Allows the CPU to quickly fetch the next operation to execute.</li>
<li>For example, when running a loop, the instruction cache holds the repeated code (<code>for</code>, <code>while</code> loops) so the CPU doesnât have to fetch it repeatedly from slower memory.</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Data Cache:</strong>
<ul>
<li><strong>What it stores:</strong>
<ul>
<li>Data refers to the values the CPU is actively working with.</li>
<li>Examples: Variables (e.g., int x = 5), memory addresses, temporary results, or input/output values.</li>
</ul>
</li>
<li><strong>Purpose:</strong>
<ul>
<li>Provides fast access to the operands (numbers, addresses) needed by instructions.</li>
<li>For example, when calculating x + y, the data cache holds the values of x and y for the ADD instruction to use.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Why Split Them?</strong></p>
<ul>
<li><strong>Parallel Access:</strong>
<ul>
<li>The CPU can fetch the next instruction (from the instruction cache) while simultaneously reading/writing data (from the data cache). This avoids bottlenecks.</li>
<li><strong>Example:</strong> While executing an ADD instruction, the CPU can already fetch the next instruction (MOV or JUMP) from the instruction cache.</li>
</ul>
</li>
<li><strong>Specialization:</strong>
<ul>
<li>Instruction caches are optimized for sequential access (program code is usually read in order).</li>
<li>Data caches are optimized for random access (variables can be accessed in any order).</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l1-cache-level-1-cache">L1 Cache (Level 1 Cache)<a href="#l1-cache-level-1-cache" class="hash-link" aria-label="Direct link to L1 Cache (Level 1 Cache)" title="Direct link to L1 Cache (Level 1 Cache)">â</a></h3>
<ul>
<li><strong>Role:</strong>
<ul>
<li>The fastest and smallest cache, directly integrated into the CPU core.</li>
<li>Split into L1 Instruction Cache (stores executable code) and L1 Data Cache (stores data).</li>
</ul>
</li>
<li><strong>Characteristics:</strong>
<ul>
<li><strong>Size:</strong> Typically 32â64 KB per core (e.g., 64 KB total: 32 KB data + 32 KB instructions).</li>
<li><strong>Speed:</strong> 1â4 clock cycles access time (fastest).</li>
<li><strong>Location:</strong> Embedded within each CPU core.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l2-cache-level-2-cache">L2 Cache (Level 2 Cache)<a href="#l2-cache-level-2-cache" class="hash-link" aria-label="Direct link to L2 Cache (Level 2 Cache)" title="Direct link to L2 Cache (Level 2 Cache)">â</a></h3>
<ul>
<li><strong>Role:</strong>
<ul>
<li>Acts as a middle layer between L1 and L3.</li>
<li>Stores data/instructions not held in L1 but likely to be reused.</li>
</ul>
</li>
<li><strong>Characteristics:</strong>
<ul>
<li><strong>Size:</strong> 256 KBâ2 MB per core (varies by CPU design).</li>
<li><strong>Speed</strong>: 10â20 clock cycles access time.</li>
<li><strong>Location</strong>: May be shared between cores or dedicated per core (e.g., AMD Zen vs. Intel Core).</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l3-cache-level-3-cache">L3 Cache (Level 3 Cache)<a href="#l3-cache-level-3-cache" class="hash-link" aria-label="Direct link to L3 Cache (Level 3 Cache)" title="Direct link to L3 Cache (Level 3 Cache)">â</a></h3>
<ul>
<li><strong>Role:</strong>
<ul>
<li>The largest and slowest CPU cache, shared across all cores.</li>
<li>Reduces traffic to RAM by storing data shared between multiple cores.</li>
</ul>
</li>
<li><strong>Characteristics</strong>:<!-- -->
<ul>
<li><strong>Size</strong>: 4â64 MB</li>
<li><strong>Speed</strong>: 20â50 clock cycles access time.</li>
<li><strong>Location</strong>: On the CPU die but outside individual cores.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-three-levels">Why Three Levels?<a href="#why-three-levels" class="hash-link" aria-label="Direct link to Why Three Levels?" title="Direct link to Why Three Levels?">â</a></h3>
<ul>
<li><strong>Latency vs. Size Trade-off:</strong> L1 prioritizes speed for critical data, L2 balances speed and size, and L3 minimizes RAM access.</li>
<li><strong>Efficiency:</strong> Reduces &quot;cache misses&quot; by filtering requests through layers (90% of data is often found in L1/L2).</li>
<li><strong>Multicore Optimization:</strong> L3 enables shared data (e.g., game textures, OS tasks) to stay accessible to all cores.</li>
</ul>
<p><strong>Practical Example:</strong></p>
<ul>
<li>When running a game:<!-- -->
<ul>
<li>L1: Stores code for rendering a character (e.g., position calculations).</li>
<li>L2: Caches textures used in the current scene.</li>
<li>L3: Holds shared assets like audio files or global physics data.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-not-replace-l2-and-l3-with-l1">Why not replace L2 and L3 with L1?<a href="#why-not-replace-l2-and-l3-with-l1" class="hash-link" aria-label="Direct link to Why not replace L2 and L3 with L1?" title="Direct link to Why not replace L2 and L3 with L1?">â</a></h3>
<ul>
<li><strong>Physical Limits:</strong>
<ul>
<li>L1 is fast but bulky/power-hungry. Scaling it to L2/L3 sizes would make CPUs impractical (cost, heat, latency).</li>
</ul>
</li>
<li><strong>Hierarchy Efficiency</strong>:<!-- -->
<ul>
<li><strong>L1</strong>: Speed-optimized for critical data.</li>
<li><strong>L2</strong>: Balances size/speed for common data.</li>
<li><strong>L3</strong>: Shared, large storage to minimize RAM trips.</li>
</ul>
</li>
<li><strong>Cache Miss Mitigation</strong>:<!-- -->
<ul>
<li>Without L2/L3, frequent RAM access (~100x slower) would cripple performance.</li>
</ul>
</li>
<li><strong>Power/Heat</strong>:<!-- -->
<ul>
<li>Larger L1 would drain power and overheat CPUs.</li>
</ul>
</li>
<li><strong>Multicore Sharing</strong>:<!-- -->
<ul>
<li>L3 allows cores to access shared data without duplicating it in L1/L2.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ram-the-parts-of-the-memory-cell">RAM: The Parts of the Memory Cell<a href="#ram-the-parts-of-the-memory-cell" class="hash-link" aria-label="Direct link to RAM: The Parts of the Memory Cell" title="Direct link to RAM: The Parts of the Memory Cell">â</a></h2>
<p>Imagine a single memory cell in your computerâs RAM (the temporary memory your computer uses to do stuff). Think of it like a tiny light switch and a tiny battery working together to store a 0 or a 1 (the basic &quot;yes/no&quot; language computers use). Hereâs how it works:</p>
<ul>
<li><strong>Capacitor:</strong> A tiny âbatteryâ that can hold an electric charge.<!-- -->
<ul>
<li>Charged (has electricity) = 1</li>
<li>Not charged (empty) = 0</li>
</ul>
</li>
<li><strong>Transistor:</strong> A tiny âlight switchâ that controls access to the capacitor.<!-- -->
<ul>
<li>ON (switch closed) = Lets electricity flow.</li>
<li>OFF (switch open) = Blocks electricity.</li>
</ul>
</li>
<li><strong>Address Line:</strong> The wire that tells the transistor to turn ON/OFF.</li>
<li><strong>Data Line:</strong> The wire that reads or writes the charge (0 or 1) to the capacitor.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How It Works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How It Works" title="Direct link to How It Works">â</a></h3>
<ol>
<li>Writing Data (Saving a 0 or 1)<!-- -->
<ul>
<li><strong>Step 1:</strong> The CPU (computerâs brain) says, âHey, I need to save a 1 at this specific memory cell!â</li>
<li><strong>Step 2:</strong> The Address Line sends electricity (like flipping the switch ON).</li>
<li><strong>Step 3:</strong> The Data Line sends electricity to charge the capacitor (filling the tiny battery).
<strong>Result:</strong> Capacitor is charged = 1 is stored.
If the CPU wants to save a 0, the Data Line drains the capacitor instead.</li>
</ul>
</li>
<li>Reading Data (Checking if itâs 0 or 1)<!-- -->
<ul>
<li><strong>Step 1:</strong> The CPU says, âWhatâs stored at this memory cell?â</li>
<li><strong>Step 2:</strong> The Address Line sends electricity (switch ON).</li>
<li><strong>Step 3:</strong> If the capacitor is charged (storing 1), electricity flows out through the Data Line.<!-- -->
<ul>
<li><strong>Result:</strong> The CPU detects this flow = 1.</li>
</ul>
</li>
<li><strong>Step 4:</strong> If the capacitor is empty (storing 0), no electricity flows.<!-- -->
<ul>
<li><strong>Result:</strong> The CPU detects no flow = 0.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="refresh-cycle">Refresh Cycle<a href="#refresh-cycle" class="hash-link" aria-label="Direct link to Refresh Cycle" title="Direct link to Refresh Cycle">â</a></h3>
<ul>
<li>Each DRAM cell consists of a <strong>capacitor (storing a 1 or 0 as charge)</strong> and an <strong>access transistor</strong>.</li>
<li>When a cell is <strong>âchargedâ (1)</strong> or <strong>âdischargedâ (0)</strong>, that state is maintained only temporarily because the charge leaks away.</li>
<li>The <strong>DRAM controller (or memory controller)</strong> periodically reads each memory cell and then rewrites (recharges) it to restore the original value. This <strong>refresh cycle</strong> typically occurs every 64â128 milliseconds for all cells.</li>
<li>Without refreshing, the leakage would eventually cause the stored bits to flip, leading to data corruption. The periodic refresh ensures data integrity over time.</li>
</ul>
<p>Inspired by: <a href="https://medium.com/@ankur_anand/a-visual-guide-to-golang-memory-allocator-from-ground-up-e132258453ed" target="_blank" rel="noopener noreferrer">https://medium.com/@ankur_anand/a-visual-guide-to-golang-memory-allocator-from-ground-up-e132258453ed</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="Golang exploration projects" class="tag_zVej tagRegular_sFm0" href="/prabhav.tech/blog/tags/go">Go</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/prabhav.tech/blog/diy_goroutines">Writing your own Goroutines</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-03-01T00:00:00.000Z">March 1, 2025</time> Â· <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/prabhav.tech/blog/authors/prabhavdogra"><img class="avatar__photo authorImage_XqGP" src="https://media.licdn.com/dms/image/v2/D5603AQGHJzJ1YVb_og/profile-displayphoto-shrink_800_800/B56ZS6fOAFHEAc-/0/1738295534859?e=1746057600&amp;v=beta&amp;t=wTqgffLNqUVaz0xEk2OUDSEvKATaSevxvWuI99mG9XY" alt="Prabhav Dogra"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/prabhav.tech/blog/authors/prabhavdogra"><span class="authorName_yefp">Prabhav Dogra</span></a></div><small class="authorTitle_nd0D" title="Software Engineer II @ Blinkit">Software Engineer II @ Blinkit</small><div class="authorSocials_rSDt"><a href="https://github.com/prabhavdogra" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://www.linkedin.com/in/prabhav-dogra/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" class="authorSocialLink_owbf"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453" fill="#0A66C2"></path></svg></a></div></div></div></div></div></header><div class="markdown"><p>This all started when someone asked me how goroutines work internally and all I could respond with was:</p>
<blockquote>
<p>&quot;Goroutines are lightweight threads managed by the Go runtime instead of the operating system. Go runtime automatically multiplexesâmapping multiple goroutines onto a smaller number of OS threads. And that somehow makes them fast?? ðð&quot;</p>
</blockquote>
<p>If anyone asked me any in-depth questions about how this multiplexing worked I was blank. So I decided to gain a deeper understanding by implementing goroutines myself. Cloned the <a href="https://github.com/golang/go" target="_blank" rel="noopener noreferrer">Go Github repo</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="to-be-continued">To be continued...<a href="#to-be-continued" class="hash-link" aria-label="Direct link to To be continued..." title="Direct link to To be continued...">â</a></h2></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="Golang exploration projects" class="tag_zVej tagRegular_sFm0" href="/prabhav.tech/blog/tags/go">Go</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/prabhav.tech/blog/atomic_operations">How Go atomic operations avoid race conditions?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-02-28T00:00:00.000Z">February 28, 2025</time> Â· <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/prabhav.tech/blog/authors/prabhavdogra"><img class="avatar__photo authorImage_XqGP" src="https://media.licdn.com/dms/image/v2/D5603AQGHJzJ1YVb_og/profile-displayphoto-shrink_800_800/B56ZS6fOAFHEAc-/0/1738295534859?e=1746057600&amp;v=beta&amp;t=wTqgffLNqUVaz0xEk2OUDSEvKATaSevxvWuI99mG9XY" alt="Prabhav Dogra"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/prabhav.tech/blog/authors/prabhavdogra"><span class="authorName_yefp">Prabhav Dogra</span></a></div><small class="authorTitle_nd0D" title="Software Engineer II @ Blinkit">Software Engineer II @ Blinkit</small><div class="authorSocials_rSDt"><a href="https://github.com/prabhavdogra" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://www.linkedin.com/in/prabhav-dogra/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" class="authorSocialLink_owbf"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453" fill="#0A66C2"></path></svg></a></div></div></div></div></div></header><div class="markdown"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">â</a></h3>
<p>This question popped up in my head, <em>&quot;How Go atomic operations avoid race conditions?&quot;</em></p>
<p>I finally gathered the courage to open the cloned <a href="https://github.com/golang/go" target="_blank" rel="noopener noreferrer">Go Github repo</a> and scan through it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="go-code-structure">Go Code Structure<a href="#go-code-structure" class="hash-link" aria-label="Direct link to Go Code Structure" title="Direct link to Go Code Structure">â</a></h3>
<p><img decoding="async" loading="lazy" alt="Go code structure" src="/prabhav.tech/assets/images/go_structure-7a1da1e54c9b5a7c7c73d3360e7c4c52.png" width="614" height="491" class="img_ev3q"></p>
<p><em>Source: ChatGPT</em></p>
<p>I went inside the implementation of <code>CompareAndSwapInt32</code> and found this:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/sync/atomic/doc.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// CompareAndSwapInt32 executes the compare-and-swap operation for an int32 value.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Consider using the more ergonomic and less error-prone [Int32.CompareAndSwap] instead.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//go:noescape</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CompareAndSwapInt32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr </span><span class="token operator" style="color:#393A34">*</span><span class="token builtin">int32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> old</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">new</span><span class="token plain"> </span><span class="token builtin">int32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">swapped </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finding the implementation of this was not straightforward, because this method is implemented in Go Assembly:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/sync/atomic/asm.s</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEXT Â·</span><span class="token function" style="color:#d73a49">CompareAndSwapInt32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">NOSPLIT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">$</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	JMP	internalâruntimeâatomicÂ·</span><span class="token function" style="color:#d73a49">Cas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SB</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-go-assembly">What&#x27;s Go Assembly?<a href="#whats-go-assembly" class="hash-link" aria-label="Direct link to What&#x27;s Go Assembly?" title="Direct link to What&#x27;s Go Assembly?">â</a></h3>
<p>Simply put, <strong>Go Assembly</strong> is the low-level language used to write performance-critical functions in Go.
<strong>Go Assembler</strong> (Code directory path: cmd/asm) is the tool that compiles <strong>Go assembly (.s) files</strong> into machine code.
The Go assembler was heavily inspired by the <a href="https://9p.io/sys/doc/compiler.html" target="_blank" rel="noopener noreferrer">Plan 9 C compilers</a>.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Plan 9 C compilers</div><div class="admonitionContent_BuS1"><p><strong>Plan 9 C compilers (6c, 8c, 5c, etc.)</strong> were architecture-specific compilers designed to generate optimized code for different CPU architectures. Unlike GCC or LLVM, which support multiple architectures within a single compiler framework, Plan 9 used separate compilers for different instruction sets. These compilers were originally developed for the Plan 9 operating system, an experimental OS designed as a potential successor to Unix-based systems.</p><p>You can read more about it here: <a href="https://9p.io/sys/doc/compiler.html" target="_blank" rel="noopener noreferrer">https://9p.io/sys/doc/compiler.html</a></p></div></div>
<p>Go drew inspiration from 9 C Compiler:</p>
<ul>
<li>Just like <strong>Plan 9</strong> had <strong>separate compilers</strong> for <strong>different architectures</strong> (e.g., 6c for x86-64, 8c for ARM, etc.).</li>
<li>Goâs assembler follows a similar architecture-based approach, instead of a universal assembler Go has different assemblers for x86, ARM, RISC-V, etc.</li>
</ul>
<p>You can watch this, an interesting talk about <a href="https://www.youtube.com/watch?v=KINIAgRpkDA" target="_blank" rel="noopener noreferrer">Go Assembler</a> presented by Rob Pike himself.</p>
<p><a href="https://go.dev/doc/asm" target="_blank" rel="noopener noreferrer">Go Assembler Documentation</a></p>
<p>Go Assembler streamlined a lot of things:</p>
<ul>
<li><strong>Portability:</strong> It abstracts CPU architecture details better.</li>
<li><strong>Simpler syntax:</strong> No need for % prefixes, brackets, or complex addressing.</li>
<li><strong>Unified across architectures:</strong> ARM, AMD64, RISC-V, etc., use the same structure.</li>
<li><strong>Designed for the Go runtime:</strong> Helps implement Go features like garbage collection, goroutines, and stack growth efficiently.</li>
</ul>
<p>Go Assembler has 4 architecture-specific implementations of <code>atomic.CompareAndSwapInt32()</code>:</p>
<ul>
<li><strong>amd64.s</strong>: For AMD64 (x86-64) architecture (Intel, AMD CPUs).</li>
<li><strong>arm64.s:</strong> For ARM64 (AArch64) processors (used in Apple M1/M2, mobile devices, servers).</li>
<li><strong>ppc64le.s:</strong> For PowerPC 64-bit, Little Endian (used in IBM systems).</li>
<li><strong>s390x.s:</strong> For IBM Z-series mainframes (used in enterprise computing).</li>
</ul>
<p>Go runs on multiple architectures, and low-level atomic operations must be natively implemented for each to ensure compatibility.</p>
<p>Added the implementations for one architecture (other 3 are similar) in Go Assembly:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">src/internal/runtime/atomic/atomic_amd64.s</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// bool Cas(int32 *val, int32 old, int32 new)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Atomically:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//	if(*val == old){</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//		*val = new;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//		return 1;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//	} else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//		return 0;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//  }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEXT Â·</span><span class="token function" style="color:#d73a49">Cas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">NOSPLIT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">$</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	MOVQ	ptr</span><span class="token operator" style="color:#393A34">+</span><span class="token function" style="color:#d73a49">0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	MOVL	old</span><span class="token operator" style="color:#393A34">+</span><span class="token function" style="color:#d73a49">8</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	MOVL	</span><span class="token builtin">new</span><span class="token operator" style="color:#393A34">+</span><span class="token function" style="color:#d73a49">12</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	LOCK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	CMPXCHGL	CX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	SETEQ	ret</span><span class="token operator" style="color:#393A34">+</span><span class="token function" style="color:#d73a49">16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	RET</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Explaining this line by line how this maintains atomicity.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEXT Â·</span><span class="token function" style="color:#d73a49">Cas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">NOSPLIT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">$</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">17</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>TEXT Â·Cas(SB)</code>: Declares the function Cas(CompareAndSwap) in Go assembly.</li>
<li><code>NOSPLIT</code>: Instructs the runtime not to perform stack splitting, ensuring that the function runs without interruption. It tells the Go runtime not to perform stack splitting for that function.</li>
<li><code>$0-17:</code> Specifies the stack frame size for the function (0 bytes for local variables and 17 bytes for arguments/return values).</li>
</ul>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MOVQ ptr</span><span class="token operator" style="color:#393A34">+</span><span class="token function" style="color:#d73a49">0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BX</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Moves the pointer <code>ptr</code> (the address of val) from the function&#x27;s frame pointer (FP) into the <code>BX</code> register.</li>
</ul>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MOVL old</span><span class="token operator" style="color:#393A34">+</span><span class="token function" style="color:#d73a49">8</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AX</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Moves the old value from the frame pointer into the <code>AX</code> register.</li>
</ul>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MOVL </span><span class="token builtin">new</span><span class="token operator" style="color:#393A34">+</span><span class="token function" style="color:#d73a49">12</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CX</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Moves the new value from the frame pointer into the <code>CX</code> register.</li>
</ul>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LOCK</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>This is a crucial instruction. It prefixes the next instruction (CMPXCHGL) with a lock, ensuring that the memory operation is atomic. This lock ensures that no other process or thread can modify the memory location while the compare and exchange instruction is running.</li>
</ul>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CMPXCHGL CX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>This is the Compare and Exchange instruction. It performs the following:<!-- -->
<ul>
<li>Compares the value in AX (the old value) with the value at the memory location pointed to by BX (the val value).</li>
<li>If the values are equal, it replaces the value at 0(BX) with the value in CX (the new value).</li>
<li>The original value at 0(BX) is loaded into the AX register.</li>
</ul>
</li>
</ul>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SETEQ ret</span><span class="token operator" style="color:#393A34">+</span><span class="token function" style="color:#d73a49">16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>SETEQ sets the byte at the destination to 1 if the zero flag is set, and to 0 otherwise. In this case, it sets the return value to 1 if the comparison was equal (meaning the swap was successful), and to 0 otherwise.</li>
</ul>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">RET</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Returns from the function</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">â</a></h3>
<p>At the register level, atomicity is achieved because:</p>
<ul>
<li>The LOCK prefix serializes access across CPU cores.</li>
<li>CMPXCHGL ensures all three steps (compare, swap, write-back) happen as one unit.</li>
<li>The CPU guarantees atomicity, eliminating race conditions without software locks.</li>
</ul>
<p>Feel free to be curious and figure out the answers to your questions on your own.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="Golang exploration projects" class="tag_zVej tagRegular_sFm0" href="/prabhav.tech/blog/tags/go">Go</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/prabhavdogra?tab=repositories" target="_blank" rel="noopener noreferrer" class="footer__link-item">Projects</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact me</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/prabhav-dogra" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:prabhavdogra1@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.stopstalk.com/user/profile/prabhav_" target="_blank" rel="noopener noreferrer" class="footer__link-item">StopStalk<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prabhav.tech/blog">Exploration Blogs</a></li><li class="footer__item"><a href="https://github.com/prabhavdogra" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Prabhav Dogra</div></div></div></footer></div>
</body>
</html>